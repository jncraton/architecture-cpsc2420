11 Virtual Memory
=================

Virtual Memory
--------------

- Hides details or limitation of unerlying memory behind a modified address space

Byte Addressing
---------------

- A memory controller that allows addressing by byte rather than word is an example of a simple virtual memory system

Memory Management Unit
----------------------

- MMU
- Creates a virtual address space for the processor
- All addresses used by the CPU are virtaul addresses translated by the MMU

---

![Virtual Memory System](https://upload.wikimedia.org/wikipedia/commons/thumb/d/dc/MMU_principle_updated.png/640px-MMU_principle_updated.png)

Multiple memory system
----------------------

- An MMU can connect memories with different properties (word size, etc) into a single unified address space
- Memory requests are translated by the MMU and directed to the appropriate location in a physical memory

Ideal Implementation
--------------------

```python
if addr < 1000:
  memory1.fetch(addr)
else:
  memory2.fetch(addr - 1000)
```

Implementation
--------------

- Subtraction is too slow to be handled by the MMU
- Split address into memory page portion and physical address portion
- Look up page using high bits
- Use low bits as address in real memeory
- Page sizes must be powers of 2 for optimal performance

Holes
-----

- Virtual memory need not be contiguous
- The memory range may contain holes that do not map to a real memory
- Accessing these will result in an error

---

Most systems generally just have one type of main physical memory. Why do we use virtual memory at all?

Benefits
--------

- Homogenous integration of hardware
- Ease of programming
- Support for multiprogramming
- Protection of programs and data

Homogenous Integration
----------------------

- Different heterogenous memories can be mapped to a uniform memory space
- Systems with a main memory and GPU memory can access all memory in the same way

Ease of programming
-------------------

- Special instructions are not required to select memories
- A memory address is always just a memory address
- Copying between different physical memories is simple
- Using data between memeories is simple

Multiprocessing
---------------

- Virtual memory is needed to implement restrictions for process memory access and protection

Data Protections
----------------

- Virtual memory can be used to secure program data
- Some pages can be mark as execute only or read-only

11.11

